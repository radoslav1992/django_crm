# Как да създам и добавя Stripe линк за плащане

## Стъпка 1: Създаване на Stripe акаунт

1. Отидете на [stripe.com](https://stripe.com)
2. Кликнете на "Регистрация" (Sign up)
3. Попълнете необходимата информация
4. Потвърдете имейл адреса си

## Стъпка 2: Активиране на Payment Links

1. Влезте в Stripe Dashboard
2. От менюто отидете на **Payment Links**
3. Ако това е първия път, ще ви бъде показана страница за активиране

## Стъпка 3: Създаване на Payment Link

### Опция А: През Stripe Dashboard

1. Кликнете на **"Create payment link"** (Създай линк за плащане)
2. Изберете или създайте продукт/услуга:
   - **Име**: Примерно "Фактура INV-001"
   - **Описание**: Кратко описание на фактурата
   - **Цена**: Въведете сумата
   - **Валута**: EUR, BGN, USD и др.

3. Персонализирайте линка:
   - **Collect customer info**: Включете, за да събирате данни за клиента
   - **Allow promotion codes**: Активирайте, ако искате да използвате промо кодове
   - **Tax**: Настройте данъчна ставка (ако е приложимо)

4. Кликнете **"Create link"** (Създай линк)
5. Копирайте генерирания URL

### Опция Б: Автоматично през API (Препоръчително)

В CRM системата можете да настроите автоматично създаване на линкове:

1. Отидете в **Настройки** → **Stripe Settings**
2. Въведете вашите API ключове:
   - **Publishable Key**: `pk_live_...` или `pk_test_...`
   - **Secret Key**: `sk_live_...` или `sk_test_...`
   - **Webhook Secret**: За автоматизация на плащанията

3. Запазете настройките

## Стъпка 4: Добавяне на Payment Link към фактура

### В CRM системата:

1. Отворете фактурата, която искате да редактирате
2. Кликнете **"Edit"** (Редактирай)
3. В полето **"Payment URL"** поставете Stripe линка
4. Запазете фактурата

### Примерен Stripe Payment Link:
```
https://buy.stripe.com/test_XXXXXXXX
```

## Стъпка 5: Изпращане на фактура с Payment Link

1. Отворете фактурата
2. Кликнете **"Send Email to Client"** (Изпрати имейл на клиент)
3. Изберете email шаблон (препоръчително AI генериран шаблон с бутон за плащане)
4. Клиентът ще получи имейл с активен бутон **"Pay Now"** (Плати сега)

## Как работи процесът на плащане:

1. **Клиентът кликва** на "Pay Now" в имейла
2. **Stripe отваря** защитена страница за плащане
3. **Клиентът въвежда** картови данни
4. **Stripe обработва** плащането
5. **Вие получавате** известие за успешно плащане
6. **CRM автоматично** актуализира статуса на фактурата (ако е настроено webhook)

## Тестване

### Test Mode (Тестов режим):

Използвайте тестови картови номера:

- **Успешно плащане**: `4242 4242 4242 4242`
- **CVC**: Всяко 3-цифрено число
- **Дата на изтичане**: Всяка бъдеща дата
- **Пощенски код**: Всеки валиден код

### Преминаване към Live Mode:

1. Активирайте акаунта си в Stripe
2. Предоставете необходимата бизнес информация
3. Заменете test ключовете с live ключове в CRM
4. Тествайте с малка транзакция

## Комисиони

Stripe таксува:
- **2.9% + $0.30** за транзакция (стандартна цена за България)
- **Валутна конверсия**: Допълнително 1% ако е различна валута
- **Месечна такса**: Няма

## Допълнителни функции

### Recurring Payments (Абонаменти):

1. Създайте Product в Stripe
2. Настройте Recurring Price
3. Изберете интервал (седмично, месечно, годишно)
4. Генерирайте Payment Link за абонамент

### Payment Intent API:

За по-напреднали интеграции можете да използвате Payment Intent API директно през CRM системата.

## Често срещани проблеми

### Problem: Линкът не работи

**Решение**: 
- Проверете дали използвате правилния API ключ (test vs live)
- Уверете се, че продуктът е активен в Stripe
- Проверете дали акаунтът ви е верифициран

### Problem: Плащането не актуализира фактурата

**Решение**:
- Настройте Stripe Webhook
- Проверете Webhook logs в Stripe Dashboard
- Уверете се, че Webhook Secret е правилно конфигуриран

### Problem: Клиентът не може да плати

**Решение**:
- Проверете дали линкът не е изтекъл
- Уверете се, че сумата е правилна
- Проверете дали валутата е поддържана

## Полезни връзки

- [Stripe Dashboard](https://dashboard.stripe.com/)
- [Stripe Documentation](https://stripe.com/docs)
- [Test Cards](https://stripe.com/docs/testing)
- [Webhook Setup Guide](https://stripe.com/docs/webhooks)

## Поддръжка

Ако имате проблеми:
1. Проверете Stripe Logs
2. Проверете CRM Server Logs
3. Свържете се с поддръжката на Stripe
4. Свържете се с нашата поддръжка

---

**Забележка**: Винаги тествайте в test mode преди да използвате live payments!

